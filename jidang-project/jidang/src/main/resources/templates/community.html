<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{index :: layout(~{::content}, ~{::scripts}, ~{::css})}">

<!-- 페이지 전용 CSS -->
<th:block th:fragment="css">
    <link rel="stylesheet" th:href="@{/css/postlist.css}">
</th:block>

<!-- 본문 영역 -->
<div th:fragment="content" class="community-page">

    <section class="community-header">

        <div class="community-header-inner">

            <!-- 왼쪽: 제목 영역 -->
            <div class="header-left">
                <h1 class="community-title">커뮤니티</h1>
                <p class="community-subtitle">게임을 초월한 가장 인기 있는 게시물들</p>
            </div>

            <!-- 오른쪽: 글쓰기 버튼 -->
            <div class="header-right">
                <a th:href="@{|/post/create?gameSlug=${currentTag}|}"
                   class="write-btn">✏️ 글 작성</a>
            </div>

        </div>

    </section>

    <section class="post-list">

        <!-- 게시물 카드 반복 -->
        <article class="post-card"
                 th:each="post : ${posts}"
                 th:attr="data-href=@{|/post/detail/${post.id}|}">

            <div class="post-tag-wrapper">

                <!-- 🎮 게임 태그 박스 -->
                <span class="tag-box game-tag"
                      th:if="${post.game != null}"
                      th:text="${post.game.name}">
                </span>

                <!-- 🏷 게시물 태그 박스 -->
                <span class="tag-box post-tag"
                      th:if="${post.postTags != null and post.postTags.size() > 0}"
                      th:text="${post.postTags[0].tag.name}">
                </span>
            </div>

            <!-- 제목 -->
            <h2 class="post-title" th:text="${post.subject}">게시글 제목</h2>

            <!-- 본문 내용 요약 -->
            <p class="post-excerpt"
               th:text="${#strings.abbreviate(post.content, 80)}">
            </p>

            <!-- 작성자 + 날짜 (완전 null-safe) -->
            <div class="post-meta">
                <!-- 선택된 칭호가 존재하고, '선택안함'이 아닐 경우만 표시 -->
                <span th:if="${post.author != null
                    and post.author.selectedTitle != null
                    and post.author.selectedTitle != ''
                    and post.author.selectedTitle != '선택안함'}"
                      class="author-title">
                        [<span th:text="${post.author.selectedTitle}"></span>]
                </span>

                <span th:text="${post.author != null ? post.author.username : '알 수 없음'}"></span>
                <span class="post-meta-dot"></span>
                <span th:text="${post.createDate != null ? post.createDate : ''}"></span>
            </div>

            <!-- ★ 좋아요(개수만 출력) -->
            <div class="post-footer">
                <div class="stat stat-like">
                    <span class="stat-icon">❤</span>
                    <span th:text="${post.liker != null ? #lists.size(post.liker) : 0}">0</span>
                </div>
            </div>

        </article>

        <!-- 게시물이 없을 때 -->
        <p class="empty-message" th:if="${#lists.isEmpty(posts)}">
            아직 게시물이 없습니다. 첫 번째 글을 작성해보세요!
        </p>

    </section>

</div>

<!-- ★ 페이지 전용 JS -->
<th:block th:fragment="scripts">
    <script defer th:src="@{/js/postlist.js}"></script>
</th:block>

</html>
